{% extends "_base.html" %}
{% block content %}

<script src="{{url_for('static', filename='jquery.js')}}" type="text/javascript"></script>
<script type="text/javascript">

 (function() {
     console.log('Sanity Check100!');
 })();


 function handleClick(event) {
    event.preventDefault();
    var form_data = new FormData();
    form_data.append('file', $('#a').prop('files')[0]);

    // send `POST` request
    fetch('/tasks', {
        method: 'POST',
        cache: 'no-cache',
        credentials: 'same-origin',
        body: form_data,
    })
    .then(response => response.json())
    .then(data => getStatus(data.task_id))
    .catch(err => console.error(err));
 }


 function getStatus(taskID) {
     fetch(`/tasks/${taskID}`, {
         method: 'GET',
         headers: {
             'Content-Type': 'application/json'
         },
     })
         .then(response => response.json())
         .then(res => {
             const html = `
                 <tr>
                     <td>${taskID}</td>
                     <td>${res.task_status}</td>
                     <td>${res.task_result}</td>
                 </tr>`;
             const newRow = document.getElementById('results');
             newRow.innerHTML = html;

             const taskStatus = res.task_status;
             if (taskStatus === 'SUCCESS' || taskStatus === 'FAILURE') return false;
             setTimeout(function() {
                 getStatus(res.task_id);
             }, 1000);
         }).catch(err => console.log(err));
 }


</Script>
<!-- <head>
     <link rel="stylesheet" type="text/css" href="style/style.css" />
     </head> -->

<div id="form-container">
    <!------------------------------------------------------------------------>
    <!--                          getting from repo                         -->
    <!------------------------------------------------------------------------>
    <form action = "{{url_for('main.repo')}}" method="POST">

        <input type='text' name="repo_url" placeholder="repo url" />
        <input type='text' name="branch" placeholder="branchname" />

        <input class="button" type="submit" value="Retrieve" />

    </form>

    <!------------------------------------------------------------------------>
    <!--                           labelling text                            ->
    <!------------------------------------------------------------------------>


    <form action="{{url_for('main.label')}}" method="POST">
        <!-- <input type="text" name="language" /> -->
        <textarea name="comment"> </textarea>
        <input class="button" type="submit" value="Show results" />
        <!-- <div class="button" onClick="javascript:this.form.submit();">Show results</div> -->

        <div id="results">
            <!-- {% if result != 'none' %} -->
            {{result}}
            <!-- {% endif %} -->
            <!-- {% if image %} -->
            <img src="{{url_for('static', filename=image)}}" />
            <!-- {% endif %} -->
        </div>

    </form>


    <form name="file_labeler">
        <input type='text' name="column" placeholder="column name to filter" />
        <br />
        <input type="file" id="a" />
        <br />
        <button class="button" onclick="handleClick(event)"> submit file </button>
    </form>


</div>
{% endblock %}
