{% extends "_base.html" %}
{% block content %}

<script src="{{url_for('static', filename='jquery.js')}}" type="text/javascript"></script>
<script type="text/javascript">
 (function() {
     console.log('Sanity Check!asdasdasdbkj2qeqwkebqwkej');
 })();



 function handleClick(type) {

     var form_data = new FormData();
     form_data.append('file', $('#a').prop('files')[0]);

     /* $.ajax({
      *     type: 'POST',
      *     url:  '/tasks',
      *     data: form_data,
      *     contentType: false,
      *     cache: false,
      *     processData: false,
      *     success: function(data) { console.log('Success!'); },
      * }); */

     // send `POST` request
     fetch('/tasks', {
         method: 'POST',
         body: form_data,
     })
             .then(response => {console.log(response.json())})
             .then(data => getStatus(data.task_id))
             .catch(err => console.error(err));
 }


                     /* var file = document.getElementById('a').files[0];
                      * var fileObject  = {
                      *     'lastModified'     : file.lastModified,
                      *     'lastModifiedDate' : file.lastModifiedDate,
                      *     'filename'         : file.name,
                      *     'size'             : file.size,
                      *     'type'             : file.type
                      * };
                      * console.log(file)

                      * fetch('/tasks', {
                      *     method: 'POST',
                      *     headers: {
                      *         'Content-Type': 'application/json'
                      *     },
                      *     body: JSON.stringify({ type: type, 'file': fileObject }),
                      * })
                      *     .then(response => response.json())
                      *     .then(data => getStatus(data.task_id)); */


function getStatus(taskID) {
    fetch(`/tasks/${taskID}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        },
    })
        .then(response => response.json())
        .then(res => {
            const html = `
                <tr>
                    <td>${taskID}</td>
                    <td>${res.task_status}</td>
                    <td>${res.task_result}</td>
                </tr>`;
            const newRow = document.getElementById('results');
            newRow.innerHTML = html;

            const taskStatus = res.task_status;
            if (taskStatus === 'SUCCESS' || taskStatus === 'FAILURE') return false;
            setTimeout(function() {
                getStatus(res.task_id);
            }, 1000);
        }).catch(err => console.log(err));
}

</Script>
<!-- <head>
     <link rel="stylesheet" type="text/css" href="style/style.css" />
     </head> -->

<div id="form-container">
    <!------------------------------------------------------------------------>
    <!--                          getting from repo                         -->
    <!------------------------------------------------------------------------>
    <form action = "{{url_for('main.repo')}}" method="POST">

        <input type='text' name="repo_url" placeholder="repo url" />
        <input type='text' name="branch" placeholder="branchname" />

        <input class="button" type="submit" value="Retrieve" />

    </form>

    <!------------------------------------------------------------------------>
    <!--                           labelling text                            ->
         <!------------------------------------------------------------------------>


    <form action="{{url_for('main.label')}}" method="POST">
        <!-- <input type="text" name="language" /> -->
        <textarea name="comment"> </textarea>
        <input class="button" type="submit" value="Show results" />
        <!-- <div class="button" onClick="javascript:this.form.submit();">Show results</div> -->

        <div id="results">
            <!-- {% if result != 'none' %} -->
            {{result}}
            <!-- {% endif %} -->
            <!-- {% if image %} -->
            <img src="{{url_for('static', filename=image)}}" />
            <!-- {% endif %} -->
        </div>

    </form>


    <form name="file_labeler">
        <input type='text' name="column" placeholder="column name to filter" />
        <br />
        <input type="file" id="a" />
        <br />
        <button class="button" onclick="handleClick(1)"> submit file </button>
    </form>


</div>
{% endblock %}
